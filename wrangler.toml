name = "planning-poker-worker"
main = "worker/index.ts"
compatibility_date = "2024-11-25"
compatibility_flags = ["nodejs_compat"]
# Set via CLOUDFLARE_ACCOUNT_ID env var or `wrangler login`
# account_id = ""

# Custom domain for worker
routes = [
  { pattern = "api.happypoints.app", custom_domain = true }
]

# Durable Object binding
[[durable_objects.bindings]]
name = "GAME_SESSION"
class_name = "GameSessionDO"

# Migration to enable Durable Objects (new_sqlite_classes for free plan)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["GameSessionDO"]

# Environment variables
[vars]
ENVIRONMENT = "production"

# Dev server settings
[dev]
port = 8787

# Build config
[build]
command = "npm run build:worker"

# For development with local Vite server
[env.development.vars]
CORS_ORIGIN = "http://localhost:3000"

[env.production.vars]
CORS_ORIGIN = "https://happypoints.app"

# Cloudflare Pages configuration
pages_build_output_dir = "dist"

[pages]
production_branch = "main"
